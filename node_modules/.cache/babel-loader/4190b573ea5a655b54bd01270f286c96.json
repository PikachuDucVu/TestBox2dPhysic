{"ast":null,"code":"import _initializerDefineProperty from \"D:/projects/test-game/node_modules/@babel/runtime/helpers/esm/initializerDefineProperty.js\";\nimport _applyDecoratedDescriptor from \"D:/projects/test-game/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor.js\";\nimport _initializerWarningHelper from \"D:/projects/test-game/node_modules/@babel/runtime/helpers/esm/initializerWarningHelper.js\";\n\nvar _dec, _dec2, _class, _descriptor, _descriptor2;\n\nimport { b2BodyType, b2ShapeType } from \"box2d.ts\";\nimport { Inject, System } from \"flat-ecs\";\nimport { Color } from \"gdxts\";\nimport { Constants } from \"../Constant\";\nexport let PhysicDebugSystem = (_dec = Inject(\"physicWorld\"), _dec2 = Inject(\"shapeRenderer\"), (_class = class PhysicDebugSystem extends System {\n  constructor() {\n    super(...arguments);\n\n    _initializerDefineProperty(this, \"physicWorld\", _descriptor, this);\n\n    _initializerDefineProperty(this, \"shapeRenderer\", _descriptor2, this);\n\n    this.vertices = [];\n    this.debugColors = new Map();\n  }\n\n  initialized() {\n    this.debugColors.set(b2BodyType.b2_dynamicBody, Color.MAGENTA);\n    this.debugColors.set(b2BodyType.b2_kinematicBody, Color.GREEN);\n    this.debugColors.set(b2BodyType.b2_staticBody, Color.GREEN);\n    this.debugColors.set(b2BodyType.b2_unknown, Color.WHITE);\n  }\n\n  process() {\n    this.shapeRenderer.begin();\n    let body = this.physicWorld.GetBodyList();\n\n    while (body) {\n      const fixture = body.GetFixtureList();\n      const bodyType = body.GetType();\n      const position = body.GetPosition();\n\n      if (fixture) {\n        const type = fixture.GetType();\n\n        if (type === b2ShapeType.e_circleShape) {\n          const data = fixture.GetShape();\n          this.shapeRenderer.circle(false, position.x * Constants.METER_TO_PHYSIC_WORLD, position.y * Constants.METER_TO_PHYSIC_WORLD, data.m_radius * Constants.METER_TO_PHYSIC_WORLD, this.debugColors.get(bodyType));\n        }\n\n        if (type === b2ShapeType.e_polygonShape) {\n          const data = fixture.GetShape();\n          this.vertices.length = 0;\n\n          for (let i = 0; i < data.m_vertices.length; i++) {\n            this.vertices.push((data.m_vertices[i].x + position.x) * Constants.METER_TO_PHYSIC_WORLD);\n            this.vertices.push((data.m_vertices[i].y + position.y) * Constants.METER_TO_PHYSIC_WORLD);\n          }\n\n          this.vertices.push(this.vertices[this.vertices.length - 2]);\n          this.vertices.push(this.vertices[1]);\n          this.shapeRenderer.polygon(this.vertices, 0, this.vertices.length, this.debugColors.get(bodyType));\n        }\n      }\n\n      body = body.GetNext();\n    }\n\n    this.shapeRenderer.end();\n  }\n\n}, (_descriptor = _applyDecoratedDescriptor(_class.prototype, \"physicWorld\", [_dec], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor2 = _applyDecoratedDescriptor(_class.prototype, \"shapeRenderer\", [_dec2], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n})), _class));","map":{"version":3,"names":["b2BodyType","b2ShapeType","Inject","System","Color","Constants","PhysicDebugSystem","vertices","debugColors","Map","initialized","set","b2_dynamicBody","MAGENTA","b2_kinematicBody","GREEN","b2_staticBody","b2_unknown","WHITE","process","shapeRenderer","begin","body","physicWorld","GetBodyList","fixture","GetFixtureList","bodyType","GetType","position","GetPosition","type","e_circleShape","data","GetShape","circle","x","METER_TO_PHYSIC_WORLD","y","m_radius","get","e_polygonShape","length","i","m_vertices","push","polygon","GetNext","end"],"sources":["D:/projects/test-game/src/RenderSystem/physicDebugSystem.ts"],"sourcesContent":["import {\r\n  b2BodyType,\r\n  b2CircleShape,\r\n  b2PolygonShape,\r\n  b2ShapeType,\r\n  b2World,\r\n} from \"box2d.ts\";\r\nimport { Inject, System } from \"flat-ecs\";\r\nimport { Color, ShapeRenderer } from \"gdxts\";\r\nimport { Constants } from \"../Constant\";\r\n\r\nexport class PhysicDebugSystem extends System {\r\n  @Inject(\"physicWorld\") physicWorld: b2World;\r\n  @Inject(\"shapeRenderer\") shapeRenderer: ShapeRenderer;\r\n  vertices: number[] = [];\r\n  debugColors: Map<b2BodyType, Color> = new Map<b2BodyType, Color>();\r\n  initialized() {\r\n    this.debugColors.set(b2BodyType.b2_dynamicBody, Color.MAGENTA);\r\n    this.debugColors.set(b2BodyType.b2_kinematicBody, Color.GREEN);\r\n    this.debugColors.set(b2BodyType.b2_staticBody, Color.GREEN);\r\n    this.debugColors.set(b2BodyType.b2_unknown, Color.WHITE);\r\n  }\r\n  process(): void {\r\n    this.shapeRenderer.begin();\r\n    let body = this.physicWorld.GetBodyList();\r\n    while (body) {\r\n      const fixture = body.GetFixtureList();\r\n      const bodyType = body.GetType();\r\n      const position = body.GetPosition();\r\n      if (fixture) {\r\n        const type = fixture.GetType();\r\n        if (type === b2ShapeType.e_circleShape) {\r\n          const data = fixture.GetShape() as b2CircleShape;\r\n          this.shapeRenderer.circle(\r\n            false,\r\n            position.x * Constants.METER_TO_PHYSIC_WORLD,\r\n            position.y * Constants.METER_TO_PHYSIC_WORLD,\r\n            data.m_radius * Constants.METER_TO_PHYSIC_WORLD,\r\n            this.debugColors.get(bodyType)\r\n          );\r\n        }\r\n        if (type === b2ShapeType.e_polygonShape) {\r\n          const data = fixture.GetShape() as b2PolygonShape;\r\n          this.vertices.length = 0;\r\n          for (let i = 0; i < data.m_vertices.length; i++) {\r\n            this.vertices.push(\r\n              (data.m_vertices[i].x + position.x) *\r\n                Constants.METER_TO_PHYSIC_WORLD\r\n            );\r\n            this.vertices.push(\r\n              (data.m_vertices[i].y + position.y) *\r\n                Constants.METER_TO_PHYSIC_WORLD\r\n            );\r\n          }\r\n          this.vertices.push(this.vertices[this.vertices.length - 2]);\r\n          this.vertices.push(this.vertices[1]);\r\n\r\n          this.shapeRenderer.polygon(\r\n            this.vertices,\r\n            0,\r\n            this.vertices.length,\r\n            this.debugColors.get(bodyType)\r\n          );\r\n        }\r\n      }\r\n      body = body.GetNext();\r\n    }\r\n\r\n    this.shapeRenderer.end();\r\n  }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}