{"ast":null,"code":"import { b2World } from \"box2d.ts\";\nimport { World } from \"flat-ecs\";\nimport { PolygonBatch, ShapeRenderer, Vector2, ViewportInputHandler } from \"gdxts\";\nimport { Constants } from \"../Constant\";\nimport { PhysicDebugSystem } from \"../RenderSystem/physicDebugSystem\";\nimport { RenderSystem } from \"../RenderSystem/RenderSystem\";\nimport { InputHandlerSystem } from \"../System/inputHandlerSystem\";\nimport { createBall, createGround, createPerson } from \"../System/utils\";\nconst MAP_HEIGHT = 1000; // map height\n\nexport const createGameScreen = async (assetManager, viewport) => {\n  const gl = viewport.getContext();\n  const camera = viewport.getCamera();\n  const batch = new PolygonBatch(gl);\n  const shapeRenderer = new ShapeRenderer(gl);\n  gl.clearColor(0, 0, 0, 1);\n  const world = new World();\n  const physicWorld = new b2World({\n    x: 0,\n    y: -10\n  });\n  const mapData = await fetch(\"./datas.tmj\").then(res => res.json());\n  const groundData = mapData.layers.find(w => w.name === \"Ground\").objects;\n  const personTeam1Data = mapData.layers.find(p => p.name === \"Team1\").objects;\n  const personTeam2Data = mapData.layers.find(p => p.name === \"Team2\").objects;\n  const ball1 = mapData.layers.find(b => b.name === \"ball1\").objects;\n  const ball2 = mapData.layers.find(b => b.name === \"ball2\").objects;\n  let grounds = [];\n  let Team1 = [];\n  let Team2 = [];\n  let ballsTeam1 = [];\n  let ballsTeam2 = [];\n\n  for (let box of ball1) {\n    ballsTeam1.push(createBall(physicWorld, box.x / Constants.METER_TO_PHYSIC_WORLD, (MAP_HEIGHT - box.y) / Constants.METER_TO_PHYSIC_WORLD, 0.25));\n  }\n\n  for (let box of ball2) {\n    ballsTeam2.push(createBall(physicWorld, box.x / Constants.METER_TO_PHYSIC_WORLD, (MAP_HEIGHT - box.y) / Constants.METER_TO_PHYSIC_WORLD, 0.25));\n  }\n\n  for (let ground of groundData) {\n    grounds.push(createGround(physicWorld, ground.x / Constants.METER_TO_PHYSIC_WORLD, (MAP_HEIGHT - ground.y) / Constants.METER_TO_PHYSIC_WORLD, ground.width / Constants.METER_TO_PHYSIC_WORLD, ground.height / Constants.METER_TO_PHYSIC_WORLD));\n  }\n\n  for (let person1 of personTeam1Data) {\n    Team1.push(createPerson(physicWorld, person1.x / Constants.METER_TO_PHYSIC_WORLD, (MAP_HEIGHT - person1.y) / Constants.METER_TO_PHYSIC_WORLD, person1.width / Constants.METER_TO_PHYSIC_WORLD, person1.height / Constants.METER_TO_PHYSIC_WORLD));\n  }\n\n  for (let person2 of personTeam2Data) {\n    Team2.push(createPerson(physicWorld, person2.x / Constants.METER_TO_PHYSIC_WORLD, (MAP_HEIGHT - person2.y) / Constants.METER_TO_PHYSIC_WORLD, person2.width / Constants.METER_TO_PHYSIC_WORLD, person2.height / Constants.METER_TO_PHYSIC_WORLD));\n  }\n\n  const inputHandle = new ViewportInputHandler(viewport);\n  const StateGame = {\n    WhoisTurning: 1,\n    CooldownTime: 5,\n    changeTurn: false\n  };\n  const originPosition = new Vector2(ballsTeam1[1].GetPosition().x * Constants.METER_TO_PHYSIC_WORLD, ballsTeam1[1].GetPosition().y * Constants.METER_TO_PHYSIC_WORLD);\n  let dragPositioning = new Vector2(ballsTeam1[1].GetPosition().x * Constants.METER_TO_PHYSIC_WORLD, ballsTeam1[1].GetPosition().y * Constants.METER_TO_PHYSIC_WORLD);\n  world.register(\"gl\", gl);\n  world.register(\"viewport\", viewport);\n  world.register(\"batch\", batch);\n  world.register(\"assetManager\", assetManager);\n  world.register(\"physicWorld\", physicWorld);\n  world.register(\"inputHandle\", inputHandle);\n  world.register(\"groundData\", groundData);\n  world.register(\"shapeRenderer\", shapeRenderer);\n  world.register(\"Team1\", Team1);\n  world.register(\"Team2\", Team2);\n  world.register(\"ballsTeam1\", ballsTeam1);\n  world.register(\"originPosition\", originPosition);\n  world.register(\"dragPositioning\", dragPositioning);\n  world.register(\"StateGame\", StateGame);\n  world.addSystem(new PhysicDebugSystem(), false);\n  world.addSystem(new RenderSystem(), true);\n  world.addSystem(new InputHandlerSystem(), true);\n  return {\n    update(delta) {\n      gl.clear(gl.COLOR_BUFFER_BIT);\n      batch.setProjection(camera.combined);\n      shapeRenderer.setProjection(camera.combined);\n      world.setDelta(delta);\n      world.processActiveSystem();\n      world.processPassiveSystem();\n      physicWorld.Step(delta, 8, 3);\n    },\n\n    dispose() {}\n\n  };\n};","map":{"version":3,"names":["b2World","World","PolygonBatch","ShapeRenderer","Vector2","ViewportInputHandler","Constants","PhysicDebugSystem","RenderSystem","InputHandlerSystem","createBall","createGround","createPerson","MAP_HEIGHT","createGameScreen","assetManager","viewport","gl","getContext","camera","getCamera","batch","shapeRenderer","clearColor","world","physicWorld","x","y","mapData","fetch","then","res","json","groundData","layers","find","w","name","objects","personTeam1Data","p","personTeam2Data","ball1","b","ball2","grounds","Team1","Team2","ballsTeam1","ballsTeam2","box","push","METER_TO_PHYSIC_WORLD","ground","width","height","person1","person2","inputHandle","StateGame","WhoisTurning","CooldownTime","changeTurn","originPosition","GetPosition","dragPositioning","register","addSystem","update","delta","clear","COLOR_BUFFER_BIT","setProjection","combined","setDelta","processActiveSystem","processPassiveSystem","Step","dispose"],"sources":["D:/projects/test-game/src/GameScreen/GameScreen.ts"],"sourcesContent":["import { b2Body, b2World } from \"box2d.ts\";\r\nimport { World } from \"flat-ecs\";\r\nimport {\r\n  AssetManager,\r\n  PolygonBatch,\r\n  Screen,\r\n  ShapeRenderer,\r\n  Vector2,\r\n  Viewport,\r\n  ViewportInputHandler,\r\n} from \"gdxts\";\r\nimport { Constants } from \"../Constant\";\r\nimport { StateGame } from \"../dataGame/stateGame\";\r\nimport { PhysicDebugSystem } from \"../RenderSystem/physicDebugSystem\";\r\nimport { RenderSystem } from \"../RenderSystem/RenderSystem\";\r\nimport { InputHandlerSystem } from \"../System/inputHandlerSystem\";\r\nimport { createBall, createGround, createPerson } from \"../System/utils\";\r\n\r\nconst MAP_HEIGHT = 1000; // map height\r\nexport const createGameScreen = async (\r\n  assetManager: AssetManager,\r\n  viewport: Viewport\r\n): Promise<Screen> => {\r\n  const gl = viewport.getContext();\r\n  const camera = viewport.getCamera();\r\n  const batch = new PolygonBatch(gl);\r\n  const shapeRenderer = new ShapeRenderer(gl);\r\n  gl.clearColor(0, 0, 0, 1);\r\n\r\n  const world = new World();\r\n  const physicWorld = new b2World({\r\n    x: 0,\r\n    y: -10,\r\n  });\r\n\r\n  const mapData = await fetch(\"./datas.tmj\").then((res) => res.json());\r\n  const groundData = mapData.layers.find(\r\n    (w: any) => w.name === \"Ground\"\r\n  ).objects;\r\n  const personTeam1Data = mapData.layers.find(\r\n    (p: any) => p.name === \"Team1\"\r\n  ).objects;\r\n  const personTeam2Data = mapData.layers.find(\r\n    (p: any) => p.name === \"Team2\"\r\n  ).objects;\r\n\r\n  const ball1 = mapData.layers.find((b: any) => b.name === \"ball1\").objects;\r\n  const ball2 = mapData.layers.find((b: any) => b.name === \"ball2\").objects;\r\n\r\n  let grounds: b2Body[] = [];\r\n  let Team1: b2Body[] = [];\r\n  let Team2: b2Body[] = [];\r\n  let ballsTeam1: b2Body[] = [];\r\n  let ballsTeam2: b2Body[] = [];\r\n  for (let box of ball1) {\r\n    ballsTeam1.push(\r\n      createBall(\r\n        physicWorld,\r\n        box.x / Constants.METER_TO_PHYSIC_WORLD,\r\n        (MAP_HEIGHT - box.y) / Constants.METER_TO_PHYSIC_WORLD,\r\n        0.25\r\n      )\r\n    );\r\n  }\r\n\r\n  for (let box of ball2) {\r\n    ballsTeam2.push(\r\n      createBall(\r\n        physicWorld,\r\n        box.x / Constants.METER_TO_PHYSIC_WORLD,\r\n        (MAP_HEIGHT - box.y) / Constants.METER_TO_PHYSIC_WORLD,\r\n        0.25\r\n      )\r\n    );\r\n  }\r\n\r\n  for (let ground of groundData) {\r\n    grounds.push(\r\n      createGround(\r\n        physicWorld,\r\n        ground.x / Constants.METER_TO_PHYSIC_WORLD,\r\n        (MAP_HEIGHT - ground.y) / Constants.METER_TO_PHYSIC_WORLD,\r\n        ground.width / Constants.METER_TO_PHYSIC_WORLD,\r\n        ground.height / Constants.METER_TO_PHYSIC_WORLD\r\n      )\r\n    );\r\n  }\r\n  for (let person1 of personTeam1Data) {\r\n    Team1.push(\r\n      createPerson(\r\n        physicWorld,\r\n        person1.x / Constants.METER_TO_PHYSIC_WORLD,\r\n        (MAP_HEIGHT - person1.y) / Constants.METER_TO_PHYSIC_WORLD,\r\n        person1.width / Constants.METER_TO_PHYSIC_WORLD,\r\n        person1.height / Constants.METER_TO_PHYSIC_WORLD\r\n      )\r\n    );\r\n  }\r\n  for (let person2 of personTeam2Data) {\r\n    Team2.push(\r\n      createPerson(\r\n        physicWorld,\r\n        person2.x / Constants.METER_TO_PHYSIC_WORLD,\r\n        (MAP_HEIGHT - person2.y) / Constants.METER_TO_PHYSIC_WORLD,\r\n        person2.width / Constants.METER_TO_PHYSIC_WORLD,\r\n        person2.height / Constants.METER_TO_PHYSIC_WORLD\r\n      )\r\n    );\r\n  }\r\n  const inputHandle = new ViewportInputHandler(viewport);\r\n  const StateGame: StateGame = {\r\n    WhoisTurning: 1,\r\n    CooldownTime: 5,\r\n    changeTurn: false,\r\n  };\r\n\r\n  const originPosition = new Vector2(\r\n    ballsTeam1[1].GetPosition().x * Constants.METER_TO_PHYSIC_WORLD,\r\n    ballsTeam1[1].GetPosition().y * Constants.METER_TO_PHYSIC_WORLD\r\n  );\r\n  let dragPositioning = new Vector2(\r\n    ballsTeam1[1].GetPosition().x * Constants.METER_TO_PHYSIC_WORLD,\r\n    ballsTeam1[1].GetPosition().y * Constants.METER_TO_PHYSIC_WORLD\r\n  );\r\n\r\n  world.register(\"gl\", gl);\r\n  world.register(\"viewport\", viewport);\r\n  world.register(\"batch\", batch);\r\n  world.register(\"assetManager\", assetManager);\r\n  world.register(\"physicWorld\", physicWorld);\r\n  world.register(\"inputHandle\", inputHandle);\r\n  world.register(\"groundData\", groundData);\r\n  world.register(\"shapeRenderer\", shapeRenderer);\r\n  world.register(\"Team1\", Team1);\r\n  world.register(\"Team2\", Team2);\r\n  world.register(\"ballsTeam1\", ballsTeam1);\r\n  world.register(\"originPosition\", originPosition);\r\n  world.register(\"dragPositioning\", dragPositioning);\r\n  world.register(\"StateGame\", StateGame);\r\n\r\n  world.addSystem(new PhysicDebugSystem(), false);\r\n  world.addSystem(new RenderSystem(), true);\r\n  world.addSystem(new InputHandlerSystem(), true);\r\n\r\n  return {\r\n    update(delta: number) {\r\n      gl.clear(gl.COLOR_BUFFER_BIT);\r\n      batch.setProjection(camera.combined);\r\n      shapeRenderer.setProjection(camera.combined);\r\n      world.setDelta(delta);\r\n      world.processActiveSystem();\r\n      world.processPassiveSystem();\r\n      physicWorld.Step(delta, 8, 3);\r\n    },\r\n    dispose(): void {},\r\n  };\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}