{"ast":null,"code":"import { b2World } from \"box2d.ts\";\nimport { World } from \"flat-ecs\";\nimport { PolygonBatch, ShapeRenderer, Vector2, ViewportInputHandler } from \"gdxts\";\nimport { Constants } from \"../Constant\";\nimport { RenderSystem } from \"../RenderSystem/RenderSystem\";\nimport { InputHandlerSystem } from \"../System/inputHandlerSystem\";\nimport { createBall, createGround, createPerson } from \"../System/utils\";\nconst MAP_HEIGHT = 1000; // map height\n\nexport const createGameScreen = async (assetManager, viewport) => {\n  const gl = viewport.getContext();\n  const camera = viewport.getCamera();\n  const batch = new PolygonBatch(gl);\n  const shapeRenderer = new ShapeRenderer(gl);\n  gl.clearColor(0, 0, 0, 1);\n  const world = new World();\n  const physicWorld = new b2World({\n    x: 0,\n    y: -10\n  });\n  const mapData = await fetch(\"./datas.tmj\").then(res => res.json());\n  const groundData = mapData.layers.find(w => w.name === \"Ground\").objects;\n  const personTeam1Data = mapData.layers.find(p => p.name === \"Team1\").objects;\n  const personTeam2Data = mapData.layers.find(p => p.name === \"Team2\").objects;\n  const originPositionData = mapData.layers.find(o => o.name === \"originPosition\").objects;\n  const ball = mapData.layers.find(b => b.name === \"ball\").objects;\n  let grounds = [];\n  let Team1 = [];\n  let Team2 = [];\n  let balls = [];\n\n  for (let box of ball) {\n    balls.push(createBall(physicWorld, box.x / Constants.METER_TO_PHYSIC_WORLD, (MAP_HEIGHT - box.y) / Constants.METER_TO_PHYSIC_WORLD, 0.5));\n  }\n\n  for (let ground of groundData) {\n    grounds.push(createGround(physicWorld, ground.x / Constants.METER_TO_PHYSIC_WORLD, (MAP_HEIGHT - ground.y) / Constants.METER_TO_PHYSIC_WORLD, ground.width / Constants.METER_TO_PHYSIC_WORLD, ground.height / Constants.METER_TO_PHYSIC_WORLD));\n  }\n\n  for (let person1 of personTeam1Data) {\n    Team1.push(createPerson(physicWorld, person1.x / Constants.METER_TO_PHYSIC_WORLD, (MAP_HEIGHT - person1.y) / Constants.METER_TO_PHYSIC_WORLD, person1.width / Constants.METER_TO_PHYSIC_WORLD, person1.height / Constants.METER_TO_PHYSIC_WORLD));\n  }\n\n  for (let person2 of personTeam2Data) {\n    Team2.push(createPerson(physicWorld, person2.x / Constants.METER_TO_PHYSIC_WORLD, (MAP_HEIGHT - person2.y) / Constants.METER_TO_PHYSIC_WORLD, person2.width / Constants.METER_TO_PHYSIC_WORLD, person2.height / Constants.METER_TO_PHYSIC_WORLD));\n  }\n\n  const inputHandle = new ViewportInputHandler(viewport);\n  let originPosition = new Vector2(originPositionData[0].x, originPositionData[0].y);\n  console.log(originPositionData[0].y);\n  world.register(\"gl\", gl);\n  world.register(\"viewport\", viewport);\n  world.register(\"batch\", batch);\n  world.register(\"assetManager\", assetManager);\n  world.register(\"physicWorld\", physicWorld);\n  world.register(\"inputHandle\", inputHandle);\n  world.register(\"groundData\", groundData);\n  world.register(\"shapeRenderer\", shapeRenderer);\n  world.register(\"Team1\", Team1);\n  world.register(\"Team2\", Team2);\n  world.register(\"balls\", balls); // world.addSystem(new PhysicDebugSystem(), false);\n\n  world.addSystem(new RenderSystem(), true);\n  world.addSystem(new InputHandlerSystem(), true);\n  return {\n    update(delta) {\n      gl.clear(gl.COLOR_BUFFER_BIT);\n      batch.setProjection(camera.combined);\n      shapeRenderer.setProjection(camera.combined);\n      world.setDelta(delta);\n      world.processActiveSystem();\n      world.processPassiveSystem();\n      physicWorld.Step(delta, 8, 3);\n    },\n\n    dispose() {}\n\n  };\n};","map":{"version":3,"names":["b2World","World","PolygonBatch","ShapeRenderer","Vector2","ViewportInputHandler","Constants","RenderSystem","InputHandlerSystem","createBall","createGround","createPerson","MAP_HEIGHT","createGameScreen","assetManager","viewport","gl","getContext","camera","getCamera","batch","shapeRenderer","clearColor","world","physicWorld","x","y","mapData","fetch","then","res","json","groundData","layers","find","w","name","objects","personTeam1Data","p","personTeam2Data","originPositionData","o","ball","b","grounds","Team1","Team2","balls","box","push","METER_TO_PHYSIC_WORLD","ground","width","height","person1","person2","inputHandle","originPosition","console","log","register","addSystem","update","delta","clear","COLOR_BUFFER_BIT","setProjection","combined","setDelta","processActiveSystem","processPassiveSystem","Step","dispose"],"sources":["D:/projects/test-game/src/GameScreen/GameScreen.ts"],"sourcesContent":["import { b2Body, b2World } from \"box2d.ts\";\r\nimport { World } from \"flat-ecs\";\r\nimport {\r\n  AssetManager,\r\n  PolygonBatch,\r\n  Screen,\r\n  ShapeRenderer,\r\n  Vector2,\r\n  Viewport,\r\n  ViewportInputHandler,\r\n} from \"gdxts\";\r\nimport { Constants } from \"../Constant\";\r\nimport { PhysicDebugSystem } from \"../RenderSystem/physicDebugSystem\";\r\nimport { RenderSystem } from \"../RenderSystem/RenderSystem\";\r\nimport { InputHandlerSystem } from \"../System/inputHandlerSystem\";\r\nimport { createBall, createGround, createPerson } from \"../System/utils\";\r\n\r\nconst MAP_HEIGHT = 1000; // map height\r\nexport const createGameScreen = async (\r\n  assetManager: AssetManager,\r\n  viewport: Viewport\r\n): Promise<Screen> => {\r\n  const gl = viewport.getContext();\r\n  const camera = viewport.getCamera();\r\n  const batch = new PolygonBatch(gl);\r\n  const shapeRenderer = new ShapeRenderer(gl);\r\n  gl.clearColor(0, 0, 0, 1);\r\n\r\n  const world = new World();\r\n  const physicWorld = new b2World({\r\n    x: 0,\r\n    y: -10,\r\n  });\r\n\r\n  const mapData = await fetch(\"./datas.tmj\").then((res) => res.json());\r\n  const groundData = mapData.layers.find(\r\n    (w: any) => w.name === \"Ground\"\r\n  ).objects;\r\n  const personTeam1Data = mapData.layers.find(\r\n    (p: any) => p.name === \"Team1\"\r\n  ).objects;\r\n  const personTeam2Data = mapData.layers.find(\r\n    (p: any) => p.name === \"Team2\"\r\n  ).objects;\r\n  const originPositionData = mapData.layers.find(\r\n    (o: any) => o.name === \"originPosition\"\r\n  ).objects;\r\n  const ball = mapData.layers.find((b: any) => b.name === \"ball\").objects;\r\n  let grounds: b2Body[] = [];\r\n  let Team1: b2Body[] = [];\r\n  let Team2: b2Body[] = [];\r\n  let balls: b2Body[] = [];\r\n\r\n  for (let box of ball) {\r\n    balls.push(\r\n      createBall(\r\n        physicWorld,\r\n        box.x / Constants.METER_TO_PHYSIC_WORLD,\r\n        (MAP_HEIGHT - box.y) / Constants.METER_TO_PHYSIC_WORLD,\r\n        0.5\r\n      )\r\n    );\r\n  }\r\n\r\n  for (let ground of groundData) {\r\n    grounds.push(\r\n      createGround(\r\n        physicWorld,\r\n        ground.x / Constants.METER_TO_PHYSIC_WORLD,\r\n        (MAP_HEIGHT - ground.y) / Constants.METER_TO_PHYSIC_WORLD,\r\n        ground.width / Constants.METER_TO_PHYSIC_WORLD,\r\n        ground.height / Constants.METER_TO_PHYSIC_WORLD\r\n      )\r\n    );\r\n  }\r\n  for (let person1 of personTeam1Data) {\r\n    Team1.push(\r\n      createPerson(\r\n        physicWorld,\r\n        person1.x / Constants.METER_TO_PHYSIC_WORLD,\r\n        (MAP_HEIGHT - person1.y) / Constants.METER_TO_PHYSIC_WORLD,\r\n        person1.width / Constants.METER_TO_PHYSIC_WORLD,\r\n        person1.height / Constants.METER_TO_PHYSIC_WORLD\r\n      )\r\n    );\r\n  }\r\n  for (let person2 of personTeam2Data) {\r\n    Team2.push(\r\n      createPerson(\r\n        physicWorld,\r\n        person2.x / Constants.METER_TO_PHYSIC_WORLD,\r\n        (MAP_HEIGHT - person2.y) / Constants.METER_TO_PHYSIC_WORLD,\r\n        person2.width / Constants.METER_TO_PHYSIC_WORLD,\r\n        person2.height / Constants.METER_TO_PHYSIC_WORLD\r\n      )\r\n    );\r\n  }\r\n  const inputHandle = new ViewportInputHandler(viewport);\r\n\r\n  let originPosition = new Vector2(\r\n    originPositionData[0].x,\r\n    originPositionData[0].y\r\n  );\r\n  console.log(originPositionData[0].y);\r\n\r\n  world.register(\"gl\", gl);\r\n  world.register(\"viewport\", viewport);\r\n  world.register(\"batch\", batch);\r\n  world.register(\"assetManager\", assetManager);\r\n  world.register(\"physicWorld\", physicWorld);\r\n  world.register(\"inputHandle\", inputHandle);\r\n  world.register(\"groundData\", groundData);\r\n  world.register(\"shapeRenderer\", shapeRenderer);\r\n  world.register(\"Team1\", Team1);\r\n  world.register(\"Team2\", Team2);\r\n  world.register(\"balls\", balls);\r\n\r\n  // world.addSystem(new PhysicDebugSystem(), false);\r\n  world.addSystem(new RenderSystem(), true);\r\n  world.addSystem(new InputHandlerSystem(), true);\r\n\r\n  return {\r\n    update(delta: number) {\r\n      gl.clear(gl.COLOR_BUFFER_BIT);\r\n      batch.setProjection(camera.combined);\r\n      shapeRenderer.setProjection(camera.combined);\r\n      world.setDelta(delta);\r\n      world.processActiveSystem();\r\n      world.processPassiveSystem();\r\n      physicWorld.Step(delta, 8, 3);\r\n    },\r\n    dispose(): void {},\r\n  };\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}