{"ast":null,"code":"import { b2World } from \"box2d.ts\";\nimport { World } from \"flat-ecs\";\nimport { PolygonBatch, ShapeRenderer, Vector2, ViewportInputHandler } from \"gdxts\";\nimport { Constants } from \"../Constant\";\nimport { PhysicDebugSystem } from \"../RenderSystem/physicDebugSystem\";\nimport { RenderSystem } from \"../RenderSystem/RenderSystem\";\nimport { InputHandlerSystem } from \"../System/inputHandlerSystem\";\nimport { createBall, createGround, createPerson } from \"../System/utils\";\nconst MAP_HEIGHT = 1000; // map height\n\nexport const createGameScreen = async (assetManager, viewport) => {\n  const gl = viewport.getContext();\n  const camera = viewport.getCamera();\n  const batch = new PolygonBatch(gl);\n  const shapeRenderer = new ShapeRenderer(gl);\n  gl.clearColor(0, 0, 0, 1);\n  const world = new World();\n  const physicWorld = new b2World({\n    x: 0,\n    y: -10\n  });\n  const mapData = await fetch(\"./datas.tmj\").then(res => res.json());\n  const groundData = mapData.layers.find(w => w.name === \"Ground\").objects;\n  const personTeam1Data = mapData.layers.find(p => p.name === \"Team1\").objects;\n  const personTeam2Data = mapData.layers.find(p => p.name === \"Team2\").objects;\n  const ball = mapData.layers.find(b => b.name === \"ball1\").objects;\n  let grounds = [];\n  let Team1 = [];\n  let Team2 = [];\n  let ballsTeam1 = [];\n  let ballsTeam2 = [];\n\n  for (let box of ball) {\n    ballsTeam1.push(createBall(physicWorld, box.x / Constants.METER_TO_PHYSIC_WORLD, (MAP_HEIGHT - box.y) / Constants.METER_TO_PHYSIC_WORLD, 0.5));\n  }\n\n  for (let ground of groundData) {\n    grounds.push(createGround(physicWorld, ground.x / Constants.METER_TO_PHYSIC_WORLD, (MAP_HEIGHT - ground.y) / Constants.METER_TO_PHYSIC_WORLD, ground.width / Constants.METER_TO_PHYSIC_WORLD, ground.height / Constants.METER_TO_PHYSIC_WORLD));\n  }\n\n  for (let person1 of personTeam1Data) {\n    Team1.push(createPerson(physicWorld, person1.x / Constants.METER_TO_PHYSIC_WORLD, (MAP_HEIGHT - person1.y) / Constants.METER_TO_PHYSIC_WORLD, person1.width / Constants.METER_TO_PHYSIC_WORLD, person1.height / Constants.METER_TO_PHYSIC_WORLD));\n  }\n\n  for (let person2 of personTeam2Data) {\n    Team2.push(createPerson(physicWorld, person2.x / Constants.METER_TO_PHYSIC_WORLD, (MAP_HEIGHT - person2.y) / Constants.METER_TO_PHYSIC_WORLD, person2.width / Constants.METER_TO_PHYSIC_WORLD, person2.height / Constants.METER_TO_PHYSIC_WORLD));\n  }\n\n  const inputHandle = new ViewportInputHandler(viewport);\n  const originPosition = new Vector2(ballsTeam1[1].GetPosition().x * Constants.METER_TO_PHYSIC_WORLD, ballsTeam1[1].GetPosition().y * Constants.METER_TO_PHYSIC_WORLD);\n  let dragPositioning = new Vector2(ballsTeam1[1].GetPosition().x * Constants.METER_TO_PHYSIC_WORLD, ballsTeam1[1].GetPosition().y * Constants.METER_TO_PHYSIC_WORLD);\n  world.register(\"gl\", gl);\n  world.register(\"viewport\", viewport);\n  world.register(\"batch\", batch);\n  world.register(\"assetManager\", assetManager);\n  world.register(\"physicWorld\", physicWorld);\n  world.register(\"inputHandle\", inputHandle);\n  world.register(\"groundData\", groundData);\n  world.register(\"shapeRenderer\", shapeRenderer);\n  world.register(\"Team1\", Team1);\n  world.register(\"Team2\", Team2);\n  world.register(\"ballsTeam1\", ballsTeam1);\n  world.register(\"originPosition\", originPosition);\n  world.register(\"dragPositioning\", dragPositioning);\n  world.addSystem(new PhysicDebugSystem(), false);\n  world.addSystem(new RenderSystem(), true);\n  world.addSystem(new InputHandlerSystem(), true);\n  return {\n    update(delta) {\n      gl.clear(gl.COLOR_BUFFER_BIT);\n      batch.setProjection(camera.combined);\n      shapeRenderer.setProjection(camera.combined);\n      world.setDelta(delta);\n      world.processActiveSystem();\n      world.processPassiveSystem();\n      physicWorld.Step(delta, 8, 3);\n    },\n\n    dispose() {}\n\n  };\n};","map":{"version":3,"names":["b2World","World","PolygonBatch","ShapeRenderer","Vector2","ViewportInputHandler","Constants","PhysicDebugSystem","RenderSystem","InputHandlerSystem","createBall","createGround","createPerson","MAP_HEIGHT","createGameScreen","assetManager","viewport","gl","getContext","camera","getCamera","batch","shapeRenderer","clearColor","world","physicWorld","x","y","mapData","fetch","then","res","json","groundData","layers","find","w","name","objects","personTeam1Data","p","personTeam2Data","ball","b","grounds","Team1","Team2","ballsTeam1","ballsTeam2","box","push","METER_TO_PHYSIC_WORLD","ground","width","height","person1","person2","inputHandle","originPosition","GetPosition","dragPositioning","register","addSystem","update","delta","clear","COLOR_BUFFER_BIT","setProjection","combined","setDelta","processActiveSystem","processPassiveSystem","Step","dispose"],"sources":["D:/projects/test-game/src/GameScreen/GameScreen.ts"],"sourcesContent":["import { b2Body, b2World } from \"box2d.ts\";\r\nimport { World } from \"flat-ecs\";\r\nimport {\r\n  AssetManager,\r\n  PolygonBatch,\r\n  Screen,\r\n  ShapeRenderer,\r\n  Vector2,\r\n  Viewport,\r\n  ViewportInputHandler,\r\n} from \"gdxts\";\r\nimport { Constants } from \"../Constant\";\r\nimport { PhysicDebugSystem } from \"../RenderSystem/physicDebugSystem\";\r\nimport { RenderSystem } from \"../RenderSystem/RenderSystem\";\r\nimport { InputHandlerSystem } from \"../System/inputHandlerSystem\";\r\nimport { createBall, createGround, createPerson } from \"../System/utils\";\r\n\r\nconst MAP_HEIGHT = 1000; // map height\r\nexport const createGameScreen = async (\r\n  assetManager: AssetManager,\r\n  viewport: Viewport\r\n): Promise<Screen> => {\r\n  const gl = viewport.getContext();\r\n  const camera = viewport.getCamera();\r\n  const batch = new PolygonBatch(gl);\r\n  const shapeRenderer = new ShapeRenderer(gl);\r\n  gl.clearColor(0, 0, 0, 1);\r\n\r\n  const world = new World();\r\n  const physicWorld = new b2World({\r\n    x: 0,\r\n    y: -10,\r\n  });\r\n\r\n  const mapData = await fetch(\"./datas.tmj\").then((res) => res.json());\r\n  const groundData = mapData.layers.find(\r\n    (w: any) => w.name === \"Ground\"\r\n  ).objects;\r\n  const personTeam1Data = mapData.layers.find(\r\n    (p: any) => p.name === \"Team1\"\r\n  ).objects;\r\n  const personTeam2Data = mapData.layers.find(\r\n    (p: any) => p.name === \"Team2\"\r\n  ).objects;\r\n\r\n  const ball = mapData.layers.find((b: any) => b.name === \"ball1\").objects;\r\n  let grounds: b2Body[] = [];\r\n  let Team1: b2Body[] = [];\r\n  let Team2: b2Body[] = [];\r\n  let ballsTeam1: b2Body[] = [];\r\n  let ballsTeam2: b2Body[] = [];\r\n\r\n  for (let box of ball) {\r\n    ballsTeam1.push(\r\n      createBall(\r\n        physicWorld,\r\n        box.x / Constants.METER_TO_PHYSIC_WORLD,\r\n        (MAP_HEIGHT - box.y) / Constants.METER_TO_PHYSIC_WORLD,\r\n        0.5\r\n      )\r\n    );\r\n  }\r\n\r\n  for (let ground of groundData) {\r\n    grounds.push(\r\n      createGround(\r\n        physicWorld,\r\n        ground.x / Constants.METER_TO_PHYSIC_WORLD,\r\n        (MAP_HEIGHT - ground.y) / Constants.METER_TO_PHYSIC_WORLD,\r\n        ground.width / Constants.METER_TO_PHYSIC_WORLD,\r\n        ground.height / Constants.METER_TO_PHYSIC_WORLD\r\n      )\r\n    );\r\n  }\r\n  for (let person1 of personTeam1Data) {\r\n    Team1.push(\r\n      createPerson(\r\n        physicWorld,\r\n        person1.x / Constants.METER_TO_PHYSIC_WORLD,\r\n        (MAP_HEIGHT - person1.y) / Constants.METER_TO_PHYSIC_WORLD,\r\n        person1.width / Constants.METER_TO_PHYSIC_WORLD,\r\n        person1.height / Constants.METER_TO_PHYSIC_WORLD\r\n      )\r\n    );\r\n  }\r\n  for (let person2 of personTeam2Data) {\r\n    Team2.push(\r\n      createPerson(\r\n        physicWorld,\r\n        person2.x / Constants.METER_TO_PHYSIC_WORLD,\r\n        (MAP_HEIGHT - person2.y) / Constants.METER_TO_PHYSIC_WORLD,\r\n        person2.width / Constants.METER_TO_PHYSIC_WORLD,\r\n        person2.height / Constants.METER_TO_PHYSIC_WORLD\r\n      )\r\n    );\r\n  }\r\n  const inputHandle = new ViewportInputHandler(viewport);\r\n\r\n  const originPosition = new Vector2(\r\n    ballsTeam1[1].GetPosition().x * Constants.METER_TO_PHYSIC_WORLD,\r\n    ballsTeam1[1].GetPosition().y * Constants.METER_TO_PHYSIC_WORLD\r\n  );\r\n  let dragPositioning = new Vector2(\r\n    ballsTeam1[1].GetPosition().x * Constants.METER_TO_PHYSIC_WORLD,\r\n    ballsTeam1[1].GetPosition().y * Constants.METER_TO_PHYSIC_WORLD\r\n  );\r\n\r\n  world.register(\"gl\", gl);\r\n  world.register(\"viewport\", viewport);\r\n  world.register(\"batch\", batch);\r\n  world.register(\"assetManager\", assetManager);\r\n  world.register(\"physicWorld\", physicWorld);\r\n  world.register(\"inputHandle\", inputHandle);\r\n  world.register(\"groundData\", groundData);\r\n  world.register(\"shapeRenderer\", shapeRenderer);\r\n  world.register(\"Team1\", Team1);\r\n  world.register(\"Team2\", Team2);\r\n  world.register(\"ballsTeam1\", ballsTeam1);\r\n  world.register(\"originPosition\", originPosition);\r\n  world.register(\"dragPositioning\", dragPositioning);\r\n\r\n  world.addSystem(new PhysicDebugSystem(), false);\r\n  world.addSystem(new RenderSystem(), true);\r\n  world.addSystem(new InputHandlerSystem(), true);\r\n\r\n  return {\r\n    update(delta: number) {\r\n      gl.clear(gl.COLOR_BUFFER_BIT);\r\n      batch.setProjection(camera.combined);\r\n      shapeRenderer.setProjection(camera.combined);\r\n      world.setDelta(delta);\r\n      world.processActiveSystem();\r\n      world.processPassiveSystem();\r\n      physicWorld.Step(delta, 8, 3);\r\n    },\r\n    dispose(): void {},\r\n  };\r\n};\r\n"],"mappings":"AAAA,SAAiBA,OAAjB,QAAgC,UAAhC;AACA,SAASC,KAAT,QAAsB,UAAtB;AACA,SAEEC,YAFF,EAIEC,aAJF,EAKEC,OALF,EAOEC,oBAPF,QAQO,OARP;AASA,SAASC,SAAT,QAA0B,aAA1B;AACA,SAASC,iBAAT,QAAkC,mCAAlC;AACA,SAASC,YAAT,QAA6B,8BAA7B;AACA,SAASC,kBAAT,QAAmC,8BAAnC;AACA,SAASC,UAAT,EAAqBC,YAArB,EAAmCC,YAAnC,QAAuD,iBAAvD;AAEA,MAAMC,UAAU,GAAG,IAAnB,C,CAAyB;;AACzB,OAAO,MAAMC,gBAAgB,GAAG,OAC9BC,YAD8B,EAE9BC,QAF8B,KAGV;EACpB,MAAMC,EAAE,GAAGD,QAAQ,CAACE,UAAT,EAAX;EACA,MAAMC,MAAM,GAAGH,QAAQ,CAACI,SAAT,EAAf;EACA,MAAMC,KAAK,GAAG,IAAInB,YAAJ,CAAiBe,EAAjB,CAAd;EACA,MAAMK,aAAa,GAAG,IAAInB,aAAJ,CAAkBc,EAAlB,CAAtB;EACAA,EAAE,CAACM,UAAH,CAAc,CAAd,EAAiB,CAAjB,EAAoB,CAApB,EAAuB,CAAvB;EAEA,MAAMC,KAAK,GAAG,IAAIvB,KAAJ,EAAd;EACA,MAAMwB,WAAW,GAAG,IAAIzB,OAAJ,CAAY;IAC9B0B,CAAC,EAAE,CAD2B;IAE9BC,CAAC,EAAE,CAAC;EAF0B,CAAZ,CAApB;EAKA,MAAMC,OAAO,GAAG,MAAMC,KAAK,CAAC,aAAD,CAAL,CAAqBC,IAArB,CAA2BC,GAAD,IAASA,GAAG,CAACC,IAAJ,EAAnC,CAAtB;EACA,MAAMC,UAAU,GAAGL,OAAO,CAACM,MAAR,CAAeC,IAAf,CAChBC,CAAD,IAAYA,CAAC,CAACC,IAAF,KAAW,QADN,EAEjBC,OAFF;EAGA,MAAMC,eAAe,GAAGX,OAAO,CAACM,MAAR,CAAeC,IAAf,CACrBK,CAAD,IAAYA,CAAC,CAACH,IAAF,KAAW,OADD,EAEtBC,OAFF;EAGA,MAAMG,eAAe,GAAGb,OAAO,CAACM,MAAR,CAAeC,IAAf,CACrBK,CAAD,IAAYA,CAAC,CAACH,IAAF,KAAW,OADD,EAEtBC,OAFF;EAIA,MAAMI,IAAI,GAAGd,OAAO,CAACM,MAAR,CAAeC,IAAf,CAAqBQ,CAAD,IAAYA,CAAC,CAACN,IAAF,KAAW,OAA3C,EAAoDC,OAAjE;EACA,IAAIM,OAAiB,GAAG,EAAxB;EACA,IAAIC,KAAe,GAAG,EAAtB;EACA,IAAIC,KAAe,GAAG,EAAtB;EACA,IAAIC,UAAoB,GAAG,EAA3B;EACA,IAAIC,UAAoB,GAAG,EAA3B;;EAEA,KAAK,IAAIC,GAAT,IAAgBP,IAAhB,EAAsB;IACpBK,UAAU,CAACG,IAAX,CACExC,UAAU,CACRe,WADQ,EAERwB,GAAG,CAACvB,CAAJ,GAAQpB,SAAS,CAAC6C,qBAFV,EAGR,CAACtC,UAAU,GAAGoC,GAAG,CAACtB,CAAlB,IAAuBrB,SAAS,CAAC6C,qBAHzB,EAIR,GAJQ,CADZ;EAQD;;EAED,KAAK,IAAIC,MAAT,IAAmBnB,UAAnB,EAA+B;IAC7BW,OAAO,CAACM,IAAR,CACEvC,YAAY,CACVc,WADU,EAEV2B,MAAM,CAAC1B,CAAP,GAAWpB,SAAS,CAAC6C,qBAFX,EAGV,CAACtC,UAAU,GAAGuC,MAAM,CAACzB,CAArB,IAA0BrB,SAAS,CAAC6C,qBAH1B,EAIVC,MAAM,CAACC,KAAP,GAAe/C,SAAS,CAAC6C,qBAJf,EAKVC,MAAM,CAACE,MAAP,GAAgBhD,SAAS,CAAC6C,qBALhB,CADd;EASD;;EACD,KAAK,IAAII,OAAT,IAAoBhB,eAApB,EAAqC;IACnCM,KAAK,CAACK,IAAN,CACEtC,YAAY,CACVa,WADU,EAEV8B,OAAO,CAAC7B,CAAR,GAAYpB,SAAS,CAAC6C,qBAFZ,EAGV,CAACtC,UAAU,GAAG0C,OAAO,CAAC5B,CAAtB,IAA2BrB,SAAS,CAAC6C,qBAH3B,EAIVI,OAAO,CAACF,KAAR,GAAgB/C,SAAS,CAAC6C,qBAJhB,EAKVI,OAAO,CAACD,MAAR,GAAiBhD,SAAS,CAAC6C,qBALjB,CADd;EASD;;EACD,KAAK,IAAIK,OAAT,IAAoBf,eAApB,EAAqC;IACnCK,KAAK,CAACI,IAAN,CACEtC,YAAY,CACVa,WADU,EAEV+B,OAAO,CAAC9B,CAAR,GAAYpB,SAAS,CAAC6C,qBAFZ,EAGV,CAACtC,UAAU,GAAG2C,OAAO,CAAC7B,CAAtB,IAA2BrB,SAAS,CAAC6C,qBAH3B,EAIVK,OAAO,CAACH,KAAR,GAAgB/C,SAAS,CAAC6C,qBAJhB,EAKVK,OAAO,CAACF,MAAR,GAAiBhD,SAAS,CAAC6C,qBALjB,CADd;EASD;;EACD,MAAMM,WAAW,GAAG,IAAIpD,oBAAJ,CAAyBW,QAAzB,CAApB;EAEA,MAAM0C,cAAc,GAAG,IAAItD,OAAJ,CACrB2C,UAAU,CAAC,CAAD,CAAV,CAAcY,WAAd,GAA4BjC,CAA5B,GAAgCpB,SAAS,CAAC6C,qBADrB,EAErBJ,UAAU,CAAC,CAAD,CAAV,CAAcY,WAAd,GAA4BhC,CAA5B,GAAgCrB,SAAS,CAAC6C,qBAFrB,CAAvB;EAIA,IAAIS,eAAe,GAAG,IAAIxD,OAAJ,CACpB2C,UAAU,CAAC,CAAD,CAAV,CAAcY,WAAd,GAA4BjC,CAA5B,GAAgCpB,SAAS,CAAC6C,qBADtB,EAEpBJ,UAAU,CAAC,CAAD,CAAV,CAAcY,WAAd,GAA4BhC,CAA5B,GAAgCrB,SAAS,CAAC6C,qBAFtB,CAAtB;EAKA3B,KAAK,CAACqC,QAAN,CAAe,IAAf,EAAqB5C,EAArB;EACAO,KAAK,CAACqC,QAAN,CAAe,UAAf,EAA2B7C,QAA3B;EACAQ,KAAK,CAACqC,QAAN,CAAe,OAAf,EAAwBxC,KAAxB;EACAG,KAAK,CAACqC,QAAN,CAAe,cAAf,EAA+B9C,YAA/B;EACAS,KAAK,CAACqC,QAAN,CAAe,aAAf,EAA8BpC,WAA9B;EACAD,KAAK,CAACqC,QAAN,CAAe,aAAf,EAA8BJ,WAA9B;EACAjC,KAAK,CAACqC,QAAN,CAAe,YAAf,EAA6B5B,UAA7B;EACAT,KAAK,CAACqC,QAAN,CAAe,eAAf,EAAgCvC,aAAhC;EACAE,KAAK,CAACqC,QAAN,CAAe,OAAf,EAAwBhB,KAAxB;EACArB,KAAK,CAACqC,QAAN,CAAe,OAAf,EAAwBf,KAAxB;EACAtB,KAAK,CAACqC,QAAN,CAAe,YAAf,EAA6Bd,UAA7B;EACAvB,KAAK,CAACqC,QAAN,CAAe,gBAAf,EAAiCH,cAAjC;EACAlC,KAAK,CAACqC,QAAN,CAAe,iBAAf,EAAkCD,eAAlC;EAEApC,KAAK,CAACsC,SAAN,CAAgB,IAAIvD,iBAAJ,EAAhB,EAAyC,KAAzC;EACAiB,KAAK,CAACsC,SAAN,CAAgB,IAAItD,YAAJ,EAAhB,EAAoC,IAApC;EACAgB,KAAK,CAACsC,SAAN,CAAgB,IAAIrD,kBAAJ,EAAhB,EAA0C,IAA1C;EAEA,OAAO;IACLsD,MAAM,CAACC,KAAD,EAAgB;MACpB/C,EAAE,CAACgD,KAAH,CAAShD,EAAE,CAACiD,gBAAZ;MACA7C,KAAK,CAAC8C,aAAN,CAAoBhD,MAAM,CAACiD,QAA3B;MACA9C,aAAa,CAAC6C,aAAd,CAA4BhD,MAAM,CAACiD,QAAnC;MACA5C,KAAK,CAAC6C,QAAN,CAAeL,KAAf;MACAxC,KAAK,CAAC8C,mBAAN;MACA9C,KAAK,CAAC+C,oBAAN;MACA9C,WAAW,CAAC+C,IAAZ,CAAiBR,KAAjB,EAAwB,CAAxB,EAA2B,CAA3B;IACD,CATI;;IAULS,OAAO,GAAS,CAAE;;EAVb,CAAP;AAYD,CAvHM"},"metadata":{},"sourceType":"module"}